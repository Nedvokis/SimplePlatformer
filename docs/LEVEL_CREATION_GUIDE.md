# Руководство по созданию уровней

## 1. Введение

Уровни SimplePlatformer хранятся в формате [RON](https://github.com/ron-rs/ron) (Rusty Object Notation) — текстовом формате данных, похожем на Rust-синтаксис.

- Каждый уровень — отдельный файл в каталоге `assets/levels/`
- Именование файлов: `level_NN.ron` (например `level_01.ron`, `level_06.ron`)
- Файлы загружаются при входе в уровень и парсятся в структуру `LevelData`

## 2. Структура LevelData

Корневая структура файла уровня:

```ron
LevelData(
    name: "Название уровня",
    spawn: (x, y),
    exit: (x, y),
    tiles: [
        // список тайлов
    ],
)
```

### Поля

| Поле | Тип | Описание |
|------|-----|----------|
| `name` | `String` | Название уровня (используется для идентификации в логах) |
| `spawn` | `(f32, f32)` | Точка появления игрока в тайловых координатах |
| `exit` | `(f32, f32)` | Точка выхода (зелёный блок), при касании уровень считается пройденным |
| `tiles` | `Vec<TileEntry>` | Список всех тайлов уровня |

### TileEntry

Каждый тайл описывается структурой `TileEntry`:

```ron
TileEntry(x: 3, y: 0, kind: Platform)
```

| Поле | Тип | Описание |
|------|-----|----------|
| `x` | `i32` | Позиция по горизонтали в тайловых координатах (целое число) |
| `y` | `i32` | Позиция по вертикали в тайловых координатах (целое число) |
| `kind` | `TileKind` | Тип тайла: `Platform` или `Spikes` |

## 3. Типы тайлов

### Platform

- Серые блоки размером 32x32 пикселей
- Твёрдые — игрок стоит на них и не проваливается
- Соседние платформы (с одинаковым `y` и последовательными `x`) автоматически объединяются в единый коллайдер. Это предотвращает «призрачные столкновения» на стыках тайлов

### Spikes

- Красные блоки размером 32x32 пикселей
- При касании игрок мгновенно погибает и респаунится в точке `spawn`
- Используются для создания препятствий и повышения сложности

## 4. Система координат

- **1 тайл = 32 пикселя**
- Ось **X** растёт вправо
- Ось **Y** растёт вверх
- Точка **(0, 0)** — нижний левый угол уровня
- Координаты `spawn` и `exit` — в тайловых единицах, дробные значения допускаются (например `(2.0, 2.0)`)
- Координаты тайлов (`x`, `y` в `TileEntry`) — только целые числа

```
y
^
3 |
2 |  S              E
1 |
0 |  [====]   [======]
  +--------------------> x
     0 1 2 3 4 5 6 7 8
```

В этой схеме `S` — точка spawn, `E` — точка exit, `[====]` — платформы.

## 5. Пример минимального уровня

Простой уровень с пропастью и шипами:

```ron
LevelData(
    name: "My First Level",
    spawn: (1.0, 2.0),
    exit: (8.0, 2.0),
    tiles: [
        // Платформа-пол (левая часть)
        TileEntry(x: 0, y: 0, kind: Platform),
        TileEntry(x: 1, y: 0, kind: Platform),
        TileEntry(x: 2, y: 0, kind: Platform),
        TileEntry(x: 3, y: 0, kind: Platform),

        // Пропасть (x: 4 — пусто, нужно перепрыгнуть)

        // Шипы в пропасти (упал — погиб)
        TileEntry(x: 5, y: 0, kind: Spikes),

        // Платформа-пол (правая часть, за пропастью)
        TileEntry(x: 6, y: 0, kind: Platform),
        TileEntry(x: 7, y: 0, kind: Platform),
        TileEntry(x: 8, y: 0, kind: Platform),
    ],
)
```

**Разбор примера:**

- Игрок появляется в точке `(1.0, 2.0)` — над левой платформой (y=0 + 2 = над полом)
- Левая платформа: тайлы x=0..3 (4 блока, автоматически объединяются в один коллайдер)
- На x=4 — пустота, на x=5 — шипы (падение = смерть)
- Правая платформа: тайлы x=6..8 (3 блока)
- Выход в точке `(8.0, 2.0)` — над правой платформой

## 6. Советы по левел-дизайну

### Физические ограничения

- **Максимальная длина прыжка:** ~3 тайла по горизонтали. Пропасть шире 3 тайлов непреодолима
- **Максимальная высота прыжка:** ~3 тайла по вертикали. Платформы выше 3 тайлов недостижимы одним прыжком

### Размещение spawn и exit

- Точка `spawn` должна быть **над** платформой: если платформа на y=0, то spawn должен быть на y=1 или y=2, чтобы игрок не застрял внутри блока
- Точка `exit` должна быть рядом с платформой и доступна для игрока

### Общие рекомендации

- Шипы добавляют сложность — размещайте их в узких местах, на дне пропастей или на обязательном пути
- Чередуйте простые и сложные участки для поддержания ритма
- Первые уровни должны быть проще, чтобы игрок освоил управление
- Тестируйте уровень после каждого изменения:

```bash
cargo run
```

## 7. Как добавить уровень в игру

1. Создайте файл уровня в каталоге `assets/levels/`. Например, для шестого уровня:
   ```
   assets/levels/level_06.ron
   ```

2. Откройте файл `src/level.rs`

3. Найдите массив `LEVELS` и добавьте путь к новому файлу:
   ```rust
   pub const LEVELS: &[&str] = &[
       "assets/levels/level_01.ron",
       "assets/levels/level_02.ron",
       "assets/levels/level_03.ron",
       "assets/levels/level_04.ron",
       "assets/levels/level_05.ron",
       "assets/levels/level_06.ron",  // новый уровень
   ];
   ```

4. Перекомпилируйте и запустите игру:
   ```bash
   cargo run
   ```

Новый уровень появится на экране выбора уровней. Он будет заблокирован до прохождения предыдущего.
