# SimplePlatformer — Дизайн-документ

**Дата:** 2026-02-23
**Тип проекта:** Учебный (изучение Bevy + gamedev на Rust)
**Технологии:** Rust, Bevy 0.18, avian2d (физика)

---

## Общее описание

2D-платформер с видом сбоку. Игрок прыгает по платформам, избегает препятствий (шипы) и добирается до выхода с уровня. Графика — цветные прямоугольники. Врагов нет в первой версии.

## Архитектура

Плоская структура модулей в `src/`:

```
src/
├── main.rs          # Точка входа, App builder, подключение плагинов
├── states.rs        # GameState enum
├── menu.rs          # UI главного меню, паузы, настроек
├── player.rs        # Компоненты и системы игрока
├── level.rs         # Загрузка уровней из RON, спавн тайлов
├── physics.rs       # Настройка avian2d
└── camera.rs        # Камера, следующая за игроком
```

## Состояния игры (GameState)

```
Menu → Playing → Paused
                ↘ Settings
Menu → Settings
Paused → Settings
```

- **Menu** — главное меню (Начать игру / Настройки / Выйти)
- **Playing** — геймплей, физика активна
- **Paused** — геймплей заморожен, оверлей с затемнением
- **Settings** — настройки (доступны из меню и паузы)

Сущности каждого экрана спавнятся при входе и удаляются при выходе (StateScoped).

## Экран паузы

При нажатии `Esc` во время игры:
1. Физика и системы игрока останавливаются
2. Полупрозрачный тёмный оверлей поверх игры
3. Меню по центру: Продолжить / Настройки / В меню
4. Повторный `Esc` = Продолжить

## Игрок

**Компоненты:**
- `Player` — маркер
- Физические компоненты avian2d (RigidBody, Collider, LinearVelocity)
- `GroundDetection` — флаг "на земле"

**Поведение:**
- Горизонтальное движение: A/D с ускорением и замедлением
- Прыжок: фиксированный импульс вверх, только на земле
- Гравитация: через avian2d
- Смерть: падение ниже уровня или касание шипов → респавн в начало
- Бесконечные респавны (без системы жизней)

## Камера

Следует за игроком с плавным сглаживанием (lerp).

## Система уровней

**Формат:** RON (Rusty Object Notation)

```ron
Level(
    name: "Начало",
    spawn: (2.0, 5.0),
    exit: (28.0, 3.0),
    tiles: [
        (0, 0, Platform),
        (5, 2, Platform),
        (10, 1, Spikes),
    ],
)
```

**Типы тайлов:**
- `Platform` — твёрдая поверхность (коллайдер)
- `Spikes` — урон при касании → респавн
- `Exit` — выход с уровня → загрузка следующего

**Размер тайла:** 32x32 пикселей. Уровень — сетка тайлов.

**Прогресс:** при достижении выхода → загрузка следующего уровня. После последнего → возврат в меню.

## UI и меню

Реализация через Bevy UI.

**Главное меню:** Начать игру / Настройки / Выйти

**Настройки:**
- Громкость музыки (ползунок 0-100)
- Громкость звуков (ползунок 0-100)
- Разрешение экрана (1280x720, 1920x1080)
- Режим окна (оконный / полный экран)

**Навигация:** `↑`/`↓` + `Enter`. Текущий пункт подсвечивается цветом.

Настройки хранятся в `Resource`, применяются сразу.

## Графика

Цветные прямоугольники (Sprite с цветом):
- Игрок — яркий цвет (например, синий)
- Платформы — серый/коричневый
- Шипы — красный
- Выход — зелёный

## Отложено на потом

- Враги с AI
- Система жизней и Game Over
- Звуковые эффекты и музыка
- Сохранение настроек на диск
- Переназначение клавиш
- Pixel art спрайты и анимации

## Зависимости

```toml
bevy = { version = "0.18", default-features = false, features = ["2d"] }
avian2d = "0.3"      # Физический движок
serde = "1"          # Сериализация для RON
ron = "0.8"          # Формат уровней
```
